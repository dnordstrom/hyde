#!/usr/bin/env ruby -w

require "hyde"

# Command line options for generating config files etc.
opts = Slop.parse do
  banner "Usage: hyde [options]"

  on :h, :help, "Print this help message" do
    puts help
    exit
  end

  on :c, :configure=, "Generate configuration file in hyde/ subdirectory." do
    filename = opts[:configure].gsub(".", "_") + ".rb"

    # TODO: Check if dir exists, create dir, copy config template.

    exit
  end

  on :r, :rackup, "Generate rackup script in hyde/ subdirectory." do

    # TODO: Check if dir exists, create dir, copy rackup template.

  end
end

# Build Rack application.
app = Rack::Builder.new do
  Hyde::WardenSetup.run
  
  use Rack::Session::Cookie, secret: rand(36**(16)).to_s(36) # Length of string is 16.
  use Rack::ShowExceptions
  use Warden::Manager do |manager|
    manager.default_strategies :password
    manager.failure_app = Hyde::Managers::Auth.new
  end

  run Hyde::Application.new
end

Rack::Server.start(app: app, Port: 5000)
